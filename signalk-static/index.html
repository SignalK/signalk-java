<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Cache-Control"
	content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<meta charset="utf-8">
<meta http-equiv="cleartype" content="on">
<meta name="MobileOptimized" content="320">
<meta name="HandheldFriendly" content="True">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, user-scalable=no">
<link rel="stylesheet" href="css/bootstrap.css">
<link rel="stylesheet" href="css/bootstrap-theme.css">
<!-- 		<link rel="stylesheet" data-aload="styles/fonts.css"> -->
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<style>
body {
	padding-top: 5px;
	padding-bottom: 5px; //
	background-color: #eee;
	width: 100%;
	height: 100%;
}

.btn-primary a {
	color: aliceblue;
}

.btn {
	width: 90%;
}

.row {
	padding-top: 5px;
	padding-bottom: 5px;
	border: 1px;
	border-bottom: 1px solid #EEE;
}
</style>

<title>Freeboard K - Home</title>
</head>

<div class="container">
	<div class="page-header">
		<h1>Signal K - Start menu</h1>
	</div>
	<ul class="nav nav-tabs">
		<li class="active"><a data-toggle="tab" href="#home">Home</a></li>
		<li><a data-toggle="tab" href="#manage">Manage Apps</a></li>
		<li><a data-toggle="tab" href="#server">Manage Server</a></li>
		<li><a data-toggle="tab" href="#api">Signalk Api</a></li>

	</ul>
	<div class="tab-content">

		<div id="home" class="tab-pane fade in active">
					<p></p>
					<p>
						Use the <i>Manage Apps</i> tab to add and remove apps from this menu.
					</p>
					
			
			<div class="row">
				<div class="col-md-4">
					<a class="btn btn-primary btn-lg" role="button"
						href="login.html?target=index.html">Login</a>
				</div>
			</div>

			
			<div class="row">
				<p></p>
			</div>

		</div>
		<div id="manage" class="tab-pane fade in ">
			<div class="row">

				<div class="col-md-8">
					<h4>App Management</h4>
				</div>
			</div>
			
		</div>

		<div id="api" class="tab-pane fade in ">
			<div class="row">
				<div class="col-md-4">
					<a class="btn btn-default btn-lg" role="button"
						href="/signalk/v1/api/vessels/*">Signal K REST API</a>
				</div>
				<div class="col-md-8">
					<p>
						The REST API lets you make calls with a web browser to get data
						from the Signal K server. By default it will open at <i>http://localhost:8080/signalk/v1/api/vessels/*</i>
					</p>
					<p>
						You can navigate through the tree by appending directories as you
						would for files, eg <a
							href="/signalk/v1/api/vessels/self/navigation">http://..../signalk/v1/api/vessels/self/navigation</a>
						or <a href="/signalk/v1/api/vessels/self/environment">http://.../signalk/v1/api/vessels/self/environment</a>
					</p>
					<p>
						The content mime type is application/json, your browser may not
						display it directly. On firefox just install <a
							href="https://addons.mozilla.org/en-us/firefox/addon/jsonovich/?src=search">https://addons.mozilla.org/en-us/firefox/addon/jsonovich/?src=search</a>
					</p>
				</div>
			</div>
		</div>
		<div id="server" class="tab-pane fade in ">


			<div class="row">
				<div id="addresses" class="col-md-6"></div>
			</div>
			<div class="row">
				<div class="col-md-8">
					<div class="col-md-3">
						<a id="shutdownBtn" class="btn  btn-default btn-lg" role="button"
							href="#">Shutdown</a>
					</div>
					<div class="col-md-3">
						<a id="restartBtn" class="btn b btn-default btn-lg" role="button"
							href="#">Restart</a>
					</div>
					<div class="col-md-3">
						<a id="timeBtn" class="btn b btn-default btn-lg" role="button"
							href="#">Set RPi time</a>
					</div>
					<p>Safely stop and start the server, or set Rpi time from the browser time.</p>
				</div>
			</div>
			<div class="row">
				<div class="col-md-8">
					<div class="col-md-4">
						<a id="clearDbFutureBtn" class="btn btn-default btn-lg" role="button"
							href="#">Clear Db Future</a>
					</div>
					<div class="col-md-4">
						<a id="clearDbVesselsBtn" class="btn btn-default btn-lg" role="button"
							href="#">Clear Db Vessels</a>
					</div>
					<p>Cleans the Db, deleting dates in the future, or all vessel history.</p>
				</div>
			</div>
			<div class="row">
				<div class="col-md-4">
					<a id="logsBtn" class="btn btn-default btn-lg" role="button"
						href="/config/upload.html">Upload Charts</a>
				</div>
				<div class="col-md-8">
					<p>Upload charts</p>
				</div>
			</div>
			<div class="row">
				<div class="col-md-4">
					<a id="cfgBtn" class="btn btn-default btn-lg" role="button"
						href="/config/config.html">Configuration</a>
				</div>
				<div class="col-md-8">
					<p>Manage the configuration of the server</p>
				</div>
			</div>
			<div class="row">
				<div class="col-md-4">
					<a id="cfgBtn" class="btn btn-default btn-lg" role="button"
						href="/config/network-config.html">Network</a>
				</div>
				<div class="col-md-8">
					<p>Manage the configuration of the network</p>
				</div>
			</div>
			<div class="row">
				<div class="col-md-4">
					<a id="cfgBtn" class="btn btn-default btn-lg" role="button"
						href="/config/security.html">Users</a>
				</div>
				<div class="col-md-8">
					<p>Manage Users and Security</p>
				</div>
			</div>

			<div class="row">
				<div class="col-md-4">
					<a id="logsBtn" class="btn btn-default btn-lg" role="button"
						href="/config/logList.html">Logs</a>
				</div>
				<div class="col-md-8">
					<p>View the log files, useful for support</p>
				</div>
			</div>
			<div class="row">
				<div class="col-md-4">
					<a id="logCfgBtn" class="btn btn-default btn-lg" role="button"
						href="/config/log4j-config.html">Log Management</a>
				</div>
				<div class="col-md-8">
					<p>Manage the log4j logging, if you dont know what that is,
						dont go here</p>
				</div>
			</div>

		</div>
	</div>
</div>
<script>
	$(document)
			.ready(
					function() {

						$.ajax({
							url : "/signalk",
							dataType : "text",
							success : function(data) {
								var jsonData = JSON.parse(data);
								$("#addresses").html(
										'<pre>'
												+ JSON.stringify(jsonData,
														null, 2) + '</pre>');
							}
						});
						$.ajax({
							url : "/signalk/v1/menu",
							dataType : "text",
							success : function(data) {
								console.log(data);
								var jsonData = JSON.parse(data);
								jsonData.forEach(function(item) {
									  $("#home").append(
											  "<div class=\"row\">"+
												"<div class=\"col-md-4\">"+
													"<a class=\"btn btn-primary btn-lg\" role=\"button\""+
														"href=\""+item.location+"\">"+item.name+" v"+item.version+"</a>"+
												"</div>"+
												"<div class=\"col-md-7\">"+
													"<p>"+item.description+
															"<br/><a href=\""+item.repository+"\">"+item.repository+"</a>"+
													"</p>"+
												"</div>"+
											"</div>"
									  );
									});
							}
						});
						
						$.ajax({
							url : "/signalk/v1/apps/search",
							dataType : "text",
							success : function(data) {
								console.log(data);
								var jsonData = JSON.parse(data);
								jsonData.forEach(function(item) {
									if(item.installed){
									  $("#manage").append(
											  "<div class=\"row\">"+
												"<div class=\"col-md-4\">"+
													"<a class=\"btn btn-primary btn-lg\" role=\"button\""+
														"href=\"/signalk/v1/apps/install?appName="+item.name+"&appVersion="+item.version+"\">"+item.name+" v"+item.version+"</a>"+
												"</div>"+
												"<div class=\"col-md-2\">"+
												"<a class=\"btn btn-danger btn-lg\" role=\"button\""+
													"href=\"/signalk/v1/apps/remove?appName="+item.name+"\">Remove</a>"+
											    "</div>"+
												"<div class=\"col-md-6\">"+
													"<p>"+item.description+
													"</p>"+
												"</div>"+
											"</div>"
									  );
									}else{
										$("#manage").append(
												  "<div class=\"row\">"+
													"<div class=\"col-md-4\">"+
														"<a class=\"btn btn-primary btn-lg\" role=\"button\""+
															"href=\"/signalk/v1/apps/install?appName="+item.name+"&appVersion="+item.version+"\">"+item.name+" v"+item.version+"</a>"+
													"</div>"+
													"<div class=\"col-md-2\">"+
												    "</div>"+
													"<div class=\"col-md-6\">"+
														"<p>"+item.description+
														"</p>"+
													"</div>"+
												"</div>"
										  );
									}
									});
							}
						});
						
						$("#timeBtn")
						.on(
								'click',
								function() {
									$
											.ajax({
												url : "/signalk/control/setTime",
												dataType : "text",
												type : 'POST',
												data : new Date().toUTCString(),
												success : function(data) {
													alert(data);
												},
												error : function(data) {
													alert("Error:"
															+ JSON.stringify(data.responseText));
												}
											});
								});
						$("#restartBtn")
								.on(
										'click',
										function() {
											$
													.ajax({
														url : "/signalk/control/restart",
														dataType : "text",
														success : function(data) {
															alert(data);
														},
														error : function(data) {
															alert("Error:"
																	+ JSON.stringify(data.responseText));
														}
													});
										});
						$("#shutdownBtn")
								.on(
										'click',
										function() {
											$
													.ajax({
														url : "/signalk/control/shutdown",
														dataType : "text",
														success : function(data) {
															alert(data);
														},
														error : function(data) {
															alert("Error:"
																	+ JSON.stringify(data.responseText));
														}
													});
										});
						$("#clearDbFutureBtn")
						.on(
								'click',
								function() {
									$
											.ajax({
												url : "/signalk/control/clearDbFuture",
												dataType : "text",
												success : function(data) {
													alert(data);
												},
												error : function(data) {
													alert("Error:"
															+ JSON.stringify(data.responseText));
												}
											});
								});
						$("#clearDbVesselsBtn")
						.on(
								'click',
								function() {
									$
											.ajax({
												url : "/signalk/control/clearDbVessels",
												dataType : "text",
												success : function(data) {
													alert(data);
												},
												error : function(data) {
													alert("Error:"
															+ JSON.stringify(data.responseText));
												}
											});
								});
						

					});
</script>
</body>
</html>